---
title: "ATTENTION 1: Kotlin interfaceä¸èƒ½ä½¿ç”¨Lambdaè¡¨è¾¾å¼"
date: 2019-10-18 14:22
---

[TOC]

> æœ€è¿‘å°è¯•ä½¿ç”¨Kotlinç¼–å†™Android Appï¼Œåœ¨å°†Javaæ–‡ä»¶è½¬æ¢æˆKotlinæ—¶é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼š
>   åœ¨Kotlinä¸­ä½¿ç”¨interfaceæ—¶ï¼Œinterfaceä¸èƒ½è½¬æ¢æˆlambdaè¡¨è¾¾å¼  

# ä½¿ç”¨åœºæ™¯
## Kotlinè°ƒç”¨å†…éƒ¨interface
``` kotlin
@RunWith(AndroidJUnit4::class)
class ExampleInstrumentedTest {
    @Test
    fun useAppContext() {
        // é”™è¯¯âŒ
        // Error: Type mismatch: interred type is (View) -> Unit but KotlinInterface was expected
        setKotlinInterface { child: View -> useAppContext() }

        // æ­£ç¡®âœ…
        setKotlinInterface(object: KotlinInterface {
            override fun onClick(child: View) {
                
            }
        })
    }

    fun setKotlinInterface(x: KotlinInterface) = Unit

    interface KotlinInterface {
        fun onClick(child: View)
    }
}
```

## Kotlinè°ƒç”¨Java interface
``` kotlin
@RunWith(AndroidJUnit4::class)
class ExampleInstrumentedTest {
    @Test
    fun useAppContext() {
        // æ­£ç¡®âœ…
        setJavaInterface(object : JavaInterface {
            override fun onClick(child: View?) {
            }
        })

        // æ­£ç¡®âœ…ï¼Œä½¿ç”¨lambdaè¡¨è¾¾å¼
        setJavaInterface(JavaInterface { })
    }

    fun setJavaInterface(x: JavaInterface) = Unit
}
```
* å¢åŠ çš„JavaInterface.java
``` java
// JavaInterface.java
public interface JavaInterface {
    void onClick(View child);
}
```

## Kotlinä½¿ç”¨Javaç±»è°ƒç”¨Java interface
``` kotlin
@RunWith(AndroidJUnit4::class)
class ExampleInstrumentedTest {
    @Test
    fun useAppContext() {
        val testA = TestA()
        // æ­£ç¡®âœ…ï¼Œä½¿ç”¨lambdaè¡¨è¾¾å¼
        testA.setJavaInterface { useAppContext() }

        // æ­£ç¡®âœ…ï¼Œä½¿ç”¨lambdaè¡¨è¾¾å¼
        // æ³¨æ„è¿™ç§å†™æ³•æ­¤ç§å†™æ³•æ­¤æ—¶æ˜¯æ­£ç¡®çš„ï¼Œè€Œåœ¨ç¬¬ä¸€ç§åœºæ™¯ä¸­å°±æ˜¯ä¸æ­£ç¡®çš„
        testA.setJavaInterface { child: View? -> print("${child?.id}") }

        // æ­£ç¡®âœ…
        testA.setJavaInterface(object : JavaInterface {
            override fun onClick(child: View?) {
                useAppContext()
            }
        })
    }

    fun setJavaInterface(x: JavaInterface) = Unit
}
```
* å¢åŠ çš„TestA.java
``` java
// TestA.java
public class TestA {
    public void setJavaInterface(JavaInterface param) {
    }
}
```

# æ€»ç»“
åˆšä»Javaåˆ‡æ¢åˆ°Kotlinï¼Œç¡®å®ä¸å¤ªé€‚åº”Kotlinå†…éƒ¨çš„ä¸€äº›ç¼–ç æ–¹å¼ï¼Œå…³äºä¸‹é¢çš„é—®é¢˜ä¹Ÿè¿˜éœ€è¦ä¹‹åå»æ·±å…¥çš„æ€è€ƒå’Œæ¢ç©¶ï¼š
> Kotlinåœ¨ä½¿ç”¨è‡ªå·±çš„interfaceæ—¶ï¼Œä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨lambdaè¡¨è¾¾å¼ï¼Ÿ
> ç›®å‰çš„æƒ³æ³•ï¼šæ ¹æ®é”™è¯¯æç¤ºï¼Œåœ¨Kotlinå†…éƒ¨æ–¹æ³•ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå¯¹åº”çš„lambdaè¡¨è¾¾å¼æ‰€è¡¨ç¤ºçš„æ–¹æ³•å¯¹è±¡ä¸interfaceå¯¹è±¡ä¸èƒ½ç­‰åŒ

* éªŒè¯çŒœæµ‹ï¼Œåœ¨Kotlinæºæ–‡ä»¶ä¸­åŒæ—¶å£°æ˜å¦‚ä¸‹ä¸¤ä¸ªæ–¹æ³•å¹¶ä¸ä¼šæŠ¥é”™ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯ä¸¤ä¸ª`é‡è½½`çš„æ–¹æ³•
``` kotlin
fun setKotlinInterface(x: KotlinInterface) = Unit
fun setKotlinInterface(x: (child: View) -> Unit) = Unit
```

# æ€è€ƒğŸ¤”
åœ¨ç¼–ç æ—¶ï¼Œå¤§éƒ¨åˆ†æƒ…å†µæ˜¯åœ¨è®¾ç½®ç›‘å¬å™¨çš„æ—¶å€™ä½¿ç”¨interfaceï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§ï¼š
``` java
public class CustomComponent {
    interface Listener {
        void onListen(Object obj);
    }

    private Listener listener;

    public void setListener(Listener listener) {
        this.listener = listener;
    }
}
```
åœ¨Kotlinä¸­ï¼Œæ›´å¥½çš„æ–¹å¼å¯èƒ½æ˜¯è¿™æ ·ï¼š
``` kotlin
class CustomComponent {
    private lateinit var listener: (any:Any) -> Unit

    fun setListener(listener: (any:Any) -> Unit) {
        this.listener = listener
    }
}
```
è€Œä¸æ˜¯è¿™æ ·ï¼š
``` kotlin
class CustomComponent {
    private lateinit var listener: Listener

    interface Listener {
        fun onListen(obj: Any)
    }

    fun setListener(listener: Listener) {
        this.listener = listener
    }
}
```





















